{"version":3,"file":"index.test.js","sourceRoot":"","sources":["../src/index.test.ts"],"names":[],"mappings":";;AAAA,2BAA+C;AAC/C,+BAA+B;AAC/B,mCAA+B;AAE/B,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE;IACrB,IAAI,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC1B,MAAM,CAAC,GAAG,EAAE,CAAC,IAAA,YAAI,GAAE,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IACrC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,aAAa,EAAE,GAAG,EAAE;QACvB,4BAA4B;QAC5B,MAAM,QAAQ,GAAG,IAAA,cAAO,EAAC,4BAA4B,CAAC,CAAC;QACvD,IAAA,kBAAa,EACX,QAAQ,EACR,IAAI,CAAC,SAAS,CAAC;YACb,IAAI,EAAE,UAAU;YAChB,SAAS,EAAE,sBAAsB;YACjC,aAAa,EAAE,cAAc;YAC7B,MAAM,EAAE,WAAW;YACnB,UAAU,EAAE,aAAa;YACzB,OAAO,EAAE,IAAI;YACb,aAAa,EAAE,iBAAiB;YAChC,aAAa,EAAE,qFAAqF;YACpG,aAAa,EAAE,iBAAiB;YAChC,aAAa,EAAE,qFAAqF;YACpG,iBAAiB,EAAE,iBAAiB;YACpC,iBAAiB,EAAE,qBAAqB;YACxC,iBAAiB,EAAE,qFAAqF;YACxG,gBAAgB,EAAE,sDAAsD;YACxE,MAAM,EAAE,CAAC;YACT,YAAY,EAAE,CAAC;YACf,kBAAkB,EAAE,CAAC;YACrB,WAAW,EAAE,gCAAgC;YAC7C,YAAY,EAAE,GAAG;YACjB,SAAS,EAAE,GAAG;YACd,0BAA0B,EAAE,IAAI;YAChC,yBAAyB,EAAE,wBAAwB;YACnD,yBAAyB,EAAE,KAAK;YAChC,eAAe,EAAE,IAAI;YACrB,qBAAqB,EAAE,wBAAwB;YAC/C,qBAAqB,EAAE,UAAU;SAClC,CAAC,EACF,EAAE,QAAQ,EAAE,OAAO,EAAE,CACtB,CAAC;QAEF,MAAM,CAAC,GAAG,EAAE,CAAC,IAAA,YAAI,EAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;QACvD,IAAA,eAAU,EAAC,QAAQ,CAAC,CAAC;IACvB,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import { unlinkSync, writeFileSync } from 'fs';\nimport { resolve } from 'path';\nimport { main } from './index';\n\ndescribe('Infra', () => {\n  test('Missing config', () => {\n    expect(() => main()).not.toThrow();\n  });\n\n  test('Synth stack', () => {\n    // Create a temp config file\n    const filename = resolve('./medplum.test.config.json');\n    writeFileSync(\n      filename,\n      JSON.stringify({\n        name: 'unittest',\n        stackName: 'MedplumUnitTestStack',\n        accountNumber: '647991932601',\n        region: 'us-east-1',\n        domainName: 'medplum.com',\n        apiPort: 8103,\n        apiDomainName: 'api.medplum.com',\n        apiSslCertArn: 'arn:aws:acm:us-east-1:647991932601:certificate/08bf1daf-3a2b-4cbe-91a0-739b4364a1ec',\n        appDomainName: 'app.medplum.com',\n        appSslCertArn: 'arn:aws:acm:us-east-1:647991932601:certificate/fd21b628-b2c0-4a5d-b4f5-b5c9a6d63b1a',\n        storageBucketName: 'medplum-storage',\n        storageDomainName: 'storage.medplum.com',\n        storageSslCertArn: 'arn:aws:acm:us-east-1:647991932601:certificate/19d85245-0a1d-4bf5-9789-23082b1a15fc',\n        storagePublicKey: '-----BEGIN PUBLIC KEY-----\\n-----END PUBLIC KEY-----',\n        maxAzs: 2,\n        rdsInstances: 1,\n        desiredServerCount: 1,\n        serverImage: 'medplum/medplum-server:staging',\n        serverMemory: 512,\n        serverCpu: 256,\n        loadBalancerLoggingEnabled: true,\n        loadBalancerLoggingBucket: 'medplum-logs-us-east-1',\n        loadBalancerLoggingPrefix: 'elb',\n        clamscanEnabled: true,\n        clamscanLoggingBucket: 'medplum-logs-us-east-1',\n        clamscanLoggingPrefix: 'clamscan',\n      }),\n      { encoding: 'utf-8' }\n    );\n\n    expect(() => main({ config: filename })).not.toThrow();\n    unlinkSync(filename);\n  });\n});\n"]}